<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-6968467347801444">
    <title>Mystical Citizen</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #6a3fc6, #5a82e3);
            color: white;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            width: 100%;
        }

        .header {
            background-color: #3c4fa1;
            padding: 20px 0;
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            position: fixed; /* Keeps the header fixed at the top */
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .header h1 {
            font-size: 2.5rem;
            margin: 0;
        }

        .header .mystical {
            color: #ff61a6; /* Pink */
        }

        .blog-container {
            max-width: 800px;
            width: 100%;
            margin: 80px 10px 20px 10px; /* Added margin-top for space due to fixed header */
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }

        .blog-post {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .blog-post h2 {
            color: #ff61a6;
            font-size: 1.5rem;
        }

        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }

            .blog-post h2 {
                font-size: 1.2rem;
            }

            .blog-container {
                margin: 80px 10px 10px 10px; /* Adjust margin for small screens */
                padding: 15px;
            }

            .blog-post {
                padding: 10px;
            }

            .header {
                padding: 15px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span class="mystical">Mystical</span> Citizen</h1>
    </div>

    <div class="blog-container" id="blogPosts">
        <p>Loading blog posts...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js";

        let firebaseConfig;
        let openaiKey;  // Declare openaiKey here, will be assigned later

        // Fetch API keys from backend with proper headers
        async function fetchKeys() {
            
            try {
                const openaiRes = await fetch('/openai-key', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json' // Add Bearer token to the header
                    }
                });

                const firebaseRes = await fetch('/firebase-key', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json' // Add Bearer token to the header
                    }
                });

                const firebaseData = await firebaseRes.json();
                const openaiData = await openaiRes.json();

                firebaseConfig = {
                    apiKey: firebaseData.apiKey,
                    authDomain: "codecitizen.firebaseapp.com",
                    databaseURL: "https://codecitizen-default-rtdb.firebaseio.com",
                    projectId: "codecitizen",
                    storageBucket: "codecitizen.appspot.com",
                    messagingSenderId: "951887554060",
                    appId: "1:951887554060:web:c99c2f52eb5d4c1fd8f029"
                };

                openaiKey = openaiData.apiKey;  // Assign the OpenAI API key here after the fetch

                initializeFirebase();
                startGeneratingPosts();
            } catch (error) {
                console.error("Error fetching keys:", error);
            }
        }

        // Initialize Firebase
        let database;  // Declare database variable at the top level
        function initializeFirebase() {
            const app = initializeApp(firebaseConfig);
            database = getDatabase(app);  // Initialize the database and assign it to the variable
            const postsRef = ref(database, 'blogPosts');
            fetchBlogPosts(postsRef);
        }

        // Fetch and display blog posts
        function fetchBlogPosts(postsRef) {
            onValue(postsRef, (snapshot) => {
                const blogContainer = document.getElementById('blogPosts');
                blogContainer.innerHTML = '';

                const data = snapshot.val();
                if (data) {
                    const posts = Object.values(data).reverse();
                    posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = 'blog-post';
                        postElement.innerHTML = `<h2>${post.title}</h2><p>${post.content}</p>`;
                        blogContainer.appendChild(postElement);
                    });
                } else {
                    blogContainer.innerHTML = '<p>No blog posts yet.</p>';
                }
            });
        }

        // Generate new blog post using OpenAI
        async function generateBlogPost() {
            const prompt = "there should be no title. no weird characters. do not put a title only output the story only. do not explain anything just output the story. Do not write about a circle or a forest write about the main topic. Write a very unique mystical story about one of the main topics and choose one of the main topics randomly. Make choosing a topic an advanced random process. Advanced randomness. Atronomy, Quantum Mysticism, Ethereal Realms, Astral Projection, Sacred Geometry, Crystal Healing, Divination, The Akashic Records, The Etheric Body, Alchemy of the Soul, The Oracle’s Vision, Ancient Wisdom, The Third Eye, Shamanic Journeys, Karma and Reincarnation, Spirit Guides, The Multiverse, Sacred Circles, Soul Contracts, The Unseen Forces, The Power of Symbols, Magic of the Elements, Intuition and Inner Sight, Sacred Sound Frequencies, Energy Healing, The Flow of Chi, Light Bodies, The Astral Plane, The Sacred Feminine, Transcendental Meditation, Moon Phases and Rituals, The Dark Night of the Soul, The Path of Enlightenment, Visionary Art, Serpent Power, Metaphysical Realms, Divine Manifestation, The Golden Ratio, Celestial Beings, Cosmic Consciousness, The Spirit of the Forest, The Philosopher’s Stone, Interdimensional Beings, Astral Voyages, Soul Evolution, Psychic Abilities, Universal Energy Field, Sacred Fire, The Sacred Breath, The Divine Spark, The Eternal Flame, The Inner Temple, Light Language, Sacred Masculine, The Void, Parallel Realities, Time Bending, The Circle of Life, The Eternal Now, Spiritual Awakening, Cosmic Energy Flow, Shifting Consciousness, The Higher Self, The Law of Attraction, Soul Retrieval, The Veil Between Worlds, Ritual Magic, Channeling Messages, The Waking Dream, Soul Mates, Quantum Consciousness, The Shifting Dimensions, The Infinite Mind, Dreamtime Realms, The Ancient Mysteries, Vibrational Healing, The Light of the Ancients, Ascension Pathways, The Crystal Kingdom, The Mind-Body Connection, Lightworkers’ Journey, Deep Meditation States, The Unconscious Mind, The Holy Grail, Sacred Symbols and Archetypes, The Altar of Truth, Energy Transference, Interdimensional Travel, The Five Elements of Being, Awakening to the Divine, The Mind of the Universe, Sacred Temples of Light, The Eternal Soul, The Cosmic Spiral, Celestial Soundscapes, Spirit of the Earth, The Divine Matrix, The Ancient Ones, Light of the Universe, The Divine Flow write about very completely innovative and very different topics, do not write about the same topic."

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',

                    headers: {
                        'Authorization': `Bearer ${openaiKey}`,  // Use the openaiKey here
                        'Content-Type': 'application/json'       // Project ID
                    },
                    body: JSON.stringify({
                        model: "gpt-4-turbo",
                        messages: [
                            { role: "system", content: "You are a mystical blog writer." },
                            { role: "user", content: prompt }
                        ]
                    })
                });

                const result = await response.json();
                const generatedText = result.choices[0].message.content.trim();
                const newPost = {
                    title: generatedText.split("\n")[0],
                    content: generatedText
                };

                push(ref(database, 'blogPosts'), newPost);
            } catch (error) {
                console.error("Error generating post:", error);
            }
        }

        // Start generating blog posts every 30 seconds
        const postInterval = 30000; // 30 seconds interval in milliseconds
        function startGeneratingPosts() {
            setInterval(generateBlogPost, postInterval);
        }

        fetchKeys();
    </script>
</body>
</html>
